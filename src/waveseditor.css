/* =========================================================
   Shipwright Survivors — Wave Editor
   Minimal shell + primitives, consistent with suite tokens
   ========================================================= */

:root {
  --bg:#0f1218;
  --fg:#e9eef7;
  --ui:#151a22;
  --bd:#222937;
  --btn:#203050;
  --btn2:#2a395a;
  --accent:#4cc9f0;
  --ok:#39d98a;
  --warn:#f5c451;
  --err:#ff6b6b;

  --muted:#b9c4d6;
  --muted2:#93a3bb;
  --shadow: 0 6px 24px rgba(0,0,0,.28);

  /* Ship preview sizing (used in rows & picker) */
  --ship-icon: 72px;
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--bg);
  color: var(--fg);
  font: 14px/1.45 system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

/* Root mount */
#root, .app-shell { height: 100%; }

/* Focus affordance */
:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent) 85%, white 0%);
  outline-offset: 2px;
}

/* =========================
   App Layout
   header | main (sidebar | editor)
   ========================= */
.app-shell {
  display: grid;
  grid-template-rows: 56px 1fr;
  grid-template-columns: 100%;
}

/* Header (global nav) */
.header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 14px;
  border-bottom: 1px solid var(--bd);
  background: linear-gradient(180deg, #121722, var(--ui));
}
.header .title {
  font-size: 15px;
  font-weight: 700;
  letter-spacing: .2px;
  margin: 0;
}
.header .row { gap: 10px; }

/* Main content area */
.main {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: 14px;
  padding: 14px;
  min-height: 0;
  box-sizing: border-box;
}

/* Panels & cards */
.panel {
  background: var(--ui);
  border: 1px solid var(--bd);
  border-radius: 12px;
  padding: 14px;
  display: flex;
  flex-direction: column;
  min-height: 0;
  gap: 12px;
}
.panel h2 { margin: 0 0 4px; font-size: 14px; letter-spacing: .2px; }

/* Sidebar */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 10px;
  min-height: 0;
}
.sidebar .toolbar {
  display: flex;
  align-items: center;
  gap: 8px;
}
.wave-list {
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-right: 2px;
}
.wave-item {
  display: grid;
  grid-template-columns: 18px 1fr auto;
  gap: 8px;
  align-items: center;
  padding: 8px;
  border: 1px solid #25314a;
  background: #0f1420;
  border-radius: 8px;
  cursor: pointer;
}
.wave-item:hover { border-color: #36527a; box-shadow: 0 0 0 1px #36527a inset; }
.wave-item.selected { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent) inset; }
.wave-item .drag {
  width: 18px; height: 18px; border-radius: 4px;
  background: linear-gradient(90deg, #182235, #121b2b);
  border: 1px solid #2a3a5c;
  display: grid; place-items: center; color: #8aa1c1; font-size: 12px; user-select: none;
}
.wave-item .title { font-weight: 600; font-size: 13px; }
.wave-item .meta {
  font-size: 11px; color: var(--muted);
  display: flex; gap: 8px; flex-wrap: wrap;
}
.wave-item .danger {
  color: #ffb3b3; border: 1px solid #5a2a2a; background: #1a0d0d;
  padding: 2px 6px; border-radius: 999px; font-size: 10px;
}

/* Editor surface */
.editor {
  display: grid;
  grid-template-rows: auto 1fr;
  gap: 12px;
  min-height: 0;
}

/* The editor stack: WaveSettings (auto) + Ships (fills) + Incidents (fills) */
.editor .cards {
  display: grid;
  grid-template-rows: auto minmax(0, 1fr) minmax(0, 1fr);
  gap: 12px;
  min-height: 0; /* allow children to shrink */
}

/* Section cards (WaveSettings, ShipsCard, IncidentsCard) */
.card {
  background: var(--ui);
  border: 1px solid var(--bd);
  border-radius: 12px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  min-height: 0; /* critical when used inside a minmax(0,1fr) grid row */
}
.card .card-header {
  display: flex; align-items: center; gap: 8px;
  justify-content: space-between;
}
.card h3 { margin: 0; font-size: 13px; letter-spacing: .2px; }

/* Scrollable area inside a card for long lists */
.card-scroll {
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
  padding-right: 4px; /* room for scrollbar */
}

/* Reusable rows/controls */
.row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.col { display: flex; flex-direction: column; gap: 6px; }
.spacer { flex: 1 1 auto; }
label { font-size: 12px; opacity: .9; }


/* Inputs */
input[type="file"], input[type="text"], input[type="number"], input[type="search"], select, textarea {
  background: #0f1420;
  color: var(--fg);
  border: 1px solid #25314a;
  border-radius: 8px;
  padding: 8px 10px;
  outline: none;
}
textarea { resize: vertical; min-height: 80px; }
input[type="number"] { width: 100px; }
input:focus, select:focus, textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 35%, transparent);
}

/* Chips (compact filter/action) */
.chips { display:flex; flex-wrap:wrap; gap:6px; }
.chip {
  font-size:11px; padding:4px 8px; border-radius:999px;
  border:1px solid #2a3a5c; background:#0f1420; color:#b9c4d6;
  cursor:pointer;
}
.chip:hover { border-color:#36527a; }
.chip.active { background:#203450; border-color:#36527a; color:#d8e6ff; }

/* Buttons */
button {
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid var(--btn2);
  background: var(--btn);
  color: var(--fg);
  cursor: pointer;
  transition: transform .03s ease, background .2s;
  font-weight: 600; font-size: 13px;
}
button:hover { background: #28406b; }
button:active { transform: translateY(1px); }
button:disabled { opacity: .45; cursor: not-allowed; }

.btn-ghost { background:#0f1420; border-color:#25314a; }
.btn-danger { background:#2a1a1a; border-color:#5a2a2a; }
.btn-danger:hover { background:#3a2020; }
.icon-btn {
  display:inline-flex; align-items:center; justify-content:center;
  width:28px; height:28px; padding:0; border-radius:8px;
}

/* Pills & badges */
.pill {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 2px 8px; border-radius: 999px;
  border: 1px solid #2a3a5c; background: #0f1420;
  font-size: 11px; color: #b9c4d6;
}
.pill.ok   { border-color:#204a35; color:#bff5dc; background:#0c1713; }
.pill.warn { border-color:#594a1e; color:#ffe2a5; background:#191307; }
.pill.err  { border-color:#5a2a2a; color:#ffd1d1; background:#1a0d0d; }

/* Problems panel list */
.problems { display: grid; gap: 6px; font-size: 12px; }
.problem {
  display: grid; grid-template-columns: 56px 1fr; gap: 8px;
  padding: 6px 8px; border-radius: 8px; border: 1px solid #25314a; background: #0f1420;
}
.problem .sev { text-transform: uppercase; font-weight: 700; letter-spacing: .3px; font-size: 11px; }
.problem.err  { border-color:#5a2a2a; background:#1a0d0d; }
.problem.warn { border-color:#594a1e; background:#191307; }

/* Tables (optional) */
.table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 13px; }
.table th, .table td { text-align: left; padding: 8px 10px; border-bottom: 1px solid #25314a; }
.table th { color: var(--muted); font-weight: 600; }
.table tr:hover td { background: #0f1420; }

/* Draggable affordances */
.handle {
  width: 18px; height: 18px; border-radius: 4px;
  background: linear-gradient(90deg, #182235, #121b2b);
  border: 1px solid #2a3a5c;
  display: grid; place-items: center; color: #8aa1c1; font-size: 12px;
  cursor: grab; user-select: none;
}
.dragging { opacity: .6; }
.drop-target { outline: 2px dashed var(--accent); outline-offset: 2px; border-radius: 8px; }

/* Code blocks / JSON editors */
.code {
  font: 12px ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  background: #0f1420;
  border: 1px solid #25314a;
  padding: 8px;
  border-radius: 8px;
  color: #dbe6ff;
  overflow: auto;
}

/* Slider */
.slider { -webkit-appearance:none; appearance:none; width: 180px; height: 6px; background:#0f1420; border:1px solid #25314a; border-radius:999px; outline:none; }
.slider::-webkit-slider-thumb { -webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent); cursor:pointer; border:1px solid #2a3a5c; }
.slider::-moz-range-thumb { width:16px; height:16px; border-radius:50%; background:var(--accent); cursor:pointer; border:1px solid #2a3a5c; }

/* Base tiles & palette grid (shared across modals) */
.palette-grid {
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(124px, 1fr));
  gap:10px;
  padding-right:2px;
}
.tile {
  position:relative;
  height:84px;
  border:1px solid #25314a;
  border-radius:8px;
  background:#0f1420;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer;
}
.tile:hover { border-color:#36527a; box-shadow:0 0 0 1px #36527a inset; }
.tile.selected { border-color:var(--accent); box-shadow:0 0 0 2px var(--accent) inset; }
.tile .label {
  position:absolute; left:6px; bottom:4px; right:6px;
  font-size:11px; color:#b9c4d6;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; opacity:.9;
}

/* Modal (generic) */
.modal-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,.45);
  display: grid; place-items: center; z-index: 60;
}
.modal.panel { max-width: 900px; } /* legacy */
.modal {
  width: min(840px, calc(100% - 28px));
  max-height: min(80vh, 900px);
  overflow: auto;
  background: var(--ui);
  border: 1px solid var(--bd);
  border-radius: 12px;
  box-shadow: var(--shadow);
  padding: 14px;
  display: flex; flex-direction: column; gap: 12px;
}
.modal .modal-header { display:flex; align-items:center; justify-content:space-between; gap:8px; }
.modal h3 { margin: 0; font-size: 14px; letter-spacing: .2px; }

/* Ship Picker — enhanced modal */
.shippicker-modal {
  width: min(1000px, 92vw);
  min-width: 820px;
  max-width: 1100px;
  max-height: min(88vh, 980px);
  min-height: 640px;
  display: grid;
  grid-template-rows: auto auto 1fr auto;
  gap: 10px;
}
.shippicker-modal .sticky {
  position: sticky; top: 0; z-index: 2;
  background: var(--ui); border-bottom: 1px solid var(--bd);
  padding-bottom: 8px;
}
.shippicker-breadcrumb {
  display: flex; align-items: center; gap: 4px; padding: 2px 0 4px;
}
.shippicker-breadcrumb .crumb { display: inline-flex; align-items: center; gap: 4px; }
.shippicker-breadcrumb .sep { color: var(--muted2); opacity: .8; }

.shippicker-content {
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 12px;
  min-height: 0;
}
.shippicker-content .panel { min-height: 0; overflow: hidden; display: flex; flex-direction: column; }
.shippicker-content .folders { overflow: auto; }
.shippicker-content .gridwrap { overflow: auto; }

.folder-list { margin-top: 6px; display: grid; gap: 6px; }
.folder-row {
  width: 100%;
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #25314a;
  background: #0f1420;
  cursor: pointer;
}
.folder-row:hover { border-color: #36527a; box-shadow: 0 0 0 1px #36527a inset; }
.folder-name { font-size: 13px; font-weight: 600; }
.folder-row .pill { font-size: 11px; padding: 1px 6px; }

.subhead { align-items: center; justify-content: space-between; margin-bottom: 4px; }

.shippicker-grid {
  --tile-size: 124px; /* overridden inline via style */
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--tile-size), 1fr));
  gap: 10px;
  padding: 2px 2px 8px;
}
.shippicker-tile {
  height: calc(var(--tile-size) + 34px);
  display: flex; flex-direction: column;
  gap: 6px; align-items: center; justify-content: center;
}

/* Skeleton state while lazy-loading preview */
.ship-icon.skeleton {
  width: var(--ship-icon, 96px);
  height: var(--ship-icon, 96px);
  box-sizing: border-box;
  border: 1px solid #25314a;
  border-radius: 8px;
  background: linear-gradient(90deg, #0f1420 0%, #101726 50%, #0f1420 100%);
  background-size: 200% 100%;
  animation: shimmer 1.1s infinite linear;
}
@keyframes shimmer {
  0% { background-position: 0% 0; }
  100% { background-position: -200% 0; }
}

/* Hints / HUD */
.hint {
  position: absolute; top: 8px; left: 10px;
  padding: 4px 8px; border-radius: 6px;
  background: rgba(0,0,0,.35); font-size: 12px;
}

/* Utilities */
.muted   { color: var(--muted); }
.muted2  { color: var(--muted2); }
.small   { font-size: 12px; }
.tiny    { font-size: 11px; }
.ellipsis{ white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.nowrap  { white-space: nowrap; }
.center  { text-align: center; }
.right   { text-align: right; }
.list-reset { margin: 0; padding: 0; list-style: none; }
.kbd {
  font: 11px ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  background:#0d1320; border:1px solid #2a3a5c; padding:1px 5px; border-radius:6px;
  color:#dbe6ff;
}
.sr-only {
  position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
}

/* Small, crisp ship thumbnail */
.ship-icon {
  width: var(--ship-icon, 52px);
  height: var(--ship-icon, 52px);
  box-sizing: border-box;                 /* include border in final box size */
  border: 1px solid #25314a;
  border-radius: 8px;
  background: #0f1420;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex: 0 0 auto;
  overflow: hidden;                       /* keep bigger canvases contained */
}
.ship-icon canvas { image-rendering: pixelated; }

/* Ship rows should breathe with icon size */
.cards .card .row {
  min-height: calc(var(--ship-icon, 52px) + 6px);
  align-items: center;
}

/* Scrollbars (WebKit + Firefox) */
* { scrollbar-color: #2a3a5c #0f1420; scrollbar-width: thin; }
*::-webkit-scrollbar { height: 10px; width: 10px; }
*::-webkit-scrollbar-track { background: #0f1420; }
*::-webkit-scrollbar-thumb { background: #22314c; border: 2px solid #0f1420; border-radius: 999px; }
*::-webkit-scrollbar-thumb:hover { background: #2a4169; }

/* Responsive niceties */
@media (max-width: 1100px) {
  .main { grid-template-columns: 260px 1fr; }
  .shippicker-modal { min-width: 760px; }
}
@media (max-width: 900px) {
  .main { grid-template-columns: 1fr; }
  .shippicker-modal { min-width: 92vw; }
}

/* ──────────────────────────────────────────────────────────
   Ships Card: Column Grid
   - Shared template for header + rows to ensure alignment
   - Tuned for generous spacing (we have horizontal room)
   ────────────────────────────────────────────────────────── */

:root {
  /* Column sizing knobs (tweak to taste) */
  --col-icon:    96px;
  --col-drag:    28px;
  --col-ship:    1.20fr;   /* id pill */
  --col-count:   110px;
  --col-hunter:  88px;
  --col-affix:   280px;    /* select + gear */
  --col-behav:   320px;    /* select + gear */
  --col-flex:    1fr;      /* spacer */
  --col-act:     32px;     /* per-action icon button */

  --ship-grid-cols:
    var(--col-icon)
    var(--col-drag)
    var(--col-ship)
    var(--col-count)
    var(--col-hunter)
    var(--col-affix)
    var(--col-behav)
    var(--col-flex)
    var(--col-act)
    var(--col-act);
}

.ship-grid-header,
.ship-grid-row {
  display: grid;
  grid-template-columns: var(--ship-grid-cols);
  align-items: center;
  gap: 10px;
}

/* Keep row height breathing with icon size */
.ship-grid-row {
  min-height: calc(var(--ship-icon, 72px) + 12px);
}

.ship-grid-header {
  padding: 6px 8px;
  border: 1px solid #25314a;
  border-radius: 8px;
  background: linear-gradient(180deg, #0f1420, #0e1626);
  color: var(--muted);
  font-weight: 700;
  font-size: 11px;
  letter-spacing: .3px;
}

/* Column headers that need centered content */
.ship-col--center { text-align: center; }

/* Cell helper for select + gear alignment */
.cell-gear {
  display: grid;
  grid-template-columns: 1fr 28px;
  gap: 6px;
  align-items: center;
}

/* Ensure the chip truncates neatly in its column */
.ship-chip.ellipsis {
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Tighten icon buttons inside grid */
.ship-actions .icon-btn { width: 28px; height: 28px; }

/* On very narrow viewports, allow affix/behavior to compress a bit */
@media (max-width: 1100px) {
  :root {
    --col-affix:  240px;
    --col-behav:  280px;
  }
}

/* ──────────────────────────────────────────────────────────
   Incidents Card: Column Grid Alignment
   ────────────────────────────────────────────────────────── */
:root{
  --inc-col-drag:   28px;
  --inc-col-chance: 120px;
  --inc-col-script: 1.10fr;
  --inc-col-label:  0.90fr;
  --inc-col-delay:  100px;
  --inc-col-opts:   1.20fr;
  --inc-col-act:    32px;

  --inc-cols:
    var(--inc-col-drag)
    var(--inc-col-chance)
    var(--inc-col-script)
    var(--inc-col-label)
    var(--inc-col-delay)
    var(--inc-col-opts)
    var(--inc-col-act)
    var(--inc-col-act)
    var(--inc-col-act);
}

.inc-grid-header,
.inc-grid-row {
  display: grid;
  grid-template-columns: var(--inc-cols);
  align-items: center;
  gap: 10px;
}

.inc-grid-header {
  padding: 6px 8px;
  border: 1px solid #25314a;
  border-radius: 8px;
  background: linear-gradient(180deg, #0f1420, #0e1626);
  color: var(--muted);
  font-weight: 700;
  font-size: 11px;
  letter-spacing: .3px;
}

.inc-grid-row { min-height: 44px; }
.inc-grid-row .right { text-align: right; }
